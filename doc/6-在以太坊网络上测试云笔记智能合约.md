[TOC]

---

### 任务描述

在以太坊网络上测试云笔记智能合约，在前面的章节，编写并测试了云笔记智能合约。下面将`BlockchainNoteService`智能合约发布到以太坊网络上。区块链行情过于火爆，大部分人在以太坊主网上没有足够的以太币，我们选择在测试网络或私链上部署智能合约。

### 相关知识

#### 以太坊网络

#### Truffle框架

Truffle是一个世界级的开发环境，测试框架，以太坊的资源管理通道，致力于让以太坊上的开发变得简单，Truffle有以下：

* 内置的智能合约编译，链接，部署和二进制文件的管理；
* 快速开发下的自动合约测试；
* 脚本化的，可扩展的部署与发布框架；
* 部署到不管多少的公网或私网的网络环境管理功能；
* 使用EthPM&NPM提供的包管理，使用ERC190标准；
* 与合约直接通信的直接交互控制台（写完合约就可以命令行里验证了）；
* 可配的构建流程，支持紧密集成；
* 在Truffle环境里支持执行外部的脚本。

##### 编译合约

###### 合约位置

所有你的合约应该位于./contracts目录。默认我们提供了一个合约文件，一个库文件，均以.sol结尾作为示例。尽管库文件有一定的特殊性，但为简单起见，当前均称之为合约。

###### 命令

要编译您的合约，使用：

```
truffle compile
```

Truffle仅默认编译自上次编译后被修改过的文件，来减少不必要的编译。如果你想编译全部文件，可以使用--compile-all选项。

```
truffle compile --compile-all
```

###### 约定

Truffle需要定义的合约名称和文件名**准确匹配**。举例来说，如果文件名为MyContract.sol，那么合约文件须为如下两者之一：

```
contract MyContract {
  ...
}
// or
library MyContract {
  ...
}
```

这种匹配是区分大小写的，也就是说大小写也要一致。推荐大写每一个开头字母，如上述代码定义。

###### 依赖

你可以通过使用import来声明依赖。Truffle将会按正确顺序依次编译合约，并在需要的时候自动关联库。

###### 编译目录

编译的输出位于./build/contracts目录。如果目录不存在会自动创建。这些编译文件对于Truffle框架能否正常工作至关重要。你不应该在正常的编译或发布以外手动修改这些文件。

##### 部署合约

###### 移植

移植是由一些Javascript文件组成来协助发布到以太坊网络。主要目的是用来缓存你的发布任务，它的存在基于你的发布需求会改变的前提。当你的工程发生了重要的改变，你将创建新的移植脚本来将这些变化带到区块链上。之前运行移植的历史记录通过一个特殊的Migrations合约来记录到链上，下面有详细说明。

执行移植，使用下述命令：

```
truffle migrate
```

这个命令会执行所有的位于migrations目录内的移植脚本。如果你之前的移植是成功执行的。truffle migrate仅会执行新创建的移植。如果没有新的移植脚本，这个命令不同执行任何操作。可以使用选项--reset来从头执行移植脚本。

###### 移植脚本文件

这个命令会执行所有的位于migrations目录内的移植脚本。如果你之前的移植是成功执行的。truffle migrate仅会执行新创建的移植。如果没有新的移植脚本，这个命令不同执行任何操作。可以使用选项--reset来从头执行移植脚本。
一个样例文件如下：
文件名：4_example_migration.js

```
module.exports = function(deployer) {
  // deployment steps
  deployer.deploy(MyContract);
};
```

需要注意的是文件名以数字开头，一个描述性的后缀结尾。数字前缀是必须的，用于记录移植是否成功。后缀仅是为了提高可读性，以方便理解。

#### 使用`Truffle`框架测试云笔记智能合约

##### 与合约互动

部署合约后我们可以调用生成的函数greets()以及setGreeting()，我们可以使用setGreeting()函数输入一个字符串，然后创建交易将此字符串存放在以太坊区块链上，通过greets()来获取存储的值。

##### 测试合约和交易

 在test文件夹的`NoteTest.js`下写入以下代码测试合约以及交易







### 编程要求



### 测试说明

根据相关知识，按照要求完成右侧选择题任务。作答完毕，通过点击“评测”，可以验证答案的正确性。

---